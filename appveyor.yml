# See http://www.appveyor.com/docs/appveyor-yml for reference

#---------------------------------#
#      general configuration      #
#---------------------------------#

environment:
  NUGET_CSPROJ: Mayflower\Mayflower.csproj

#---------------------------------#
#    environment configuration    #
#---------------------------------#

image: Visual Studio 2017 RC

#---------------------------------#
#       build configuration       #
#---------------------------------#

platform: Any CPU

configuration: Release

before_build:
  - ps: Scripts\PatchCsproj.ps1
  - cmd: msbuild /t:restore

build:
  project: Mayflower\Mayflower.csproj
  verbosity: normal

#build_script:
#  - cmd: dotnet build -c Release -v normal

after_build:
  - cmd: msbuild %NUGET_CSPROJ% /t:pack /p:IncludeSymbols=true
#  - cmd: dotnet pack -c Release -o %APPVEYOR_BUILD_FOLDER%\nuget --include-symbols %NUGET_CSPROJ%

#---------------------------------#
#       tests configuration       #
#---------------------------------#



#---------------------------------#
#      artifacts configuration    #
#---------------------------------#

artifacts:
  - path: nuget\*

#---------------------------------#
#     deployment configuration    #
#---------------------------------#

deploy:

  - provider: GitHub
    release: $(APPVEYOR_REPO_TAG_NAME)
    auth_token:
      secure: gbdN6iXbtLTk1MiBecxRJvdoc6fR6x4AEFAQNuZ+UMR9NvQnXW12PXfd16gtGVGp
    artifact: /^.*(\.nupkg|mayflower\.exe)$/
    draft: false
    prerelease: false
    on:
      appveyor_repo_tag: true

  # for pre-release versions
  - provider: NuGet
    api_key:
      secure: NiH62CvEa6ztPGnR9glvKexCL5sJStB62JcJ/8CcVJJAj7rkCzZvfN87E5xPpNd0
    artifact: /.*\.nupkg/
    skip_symbols: false
    on:
      branch: master

  # for release versions
  - provider: NuGet
    api_key:
      secure: NiH62CvEa6ztPGnR9glvKexCL5sJStB62JcJ/8CcVJJAj7rkCzZvfN87E5xPpNd0
    artifact: /.*\.nupkg/
    skip_symbols: false
    on:
      appveyor_repo_tag: true

